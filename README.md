# utils-pkg

å®ç”¨å·¥å…·åŒ…é›†åˆï¼Œæä¾›å¸¸ç”¨çš„åŸºç¡€åŠŸèƒ½æ”¯æŒã€‚

## åŒ…å«æ¨¡å—

1. **jwt**: JWTä»¤ç‰Œç®¡ç†
   - ç”Ÿæˆä¸éªŒè¯JWTä»¤ç‰Œ
   - æ”¯æŒè®¿é—®ä»¤ç‰Œä¸åˆ·æ–°ä»¤ç‰Œ
   - é«˜æ€§èƒ½çš„ä»¤ç‰ŒéªŒè¯ç¼“å­˜
   - åˆ†æ®µé”è®¾è®¡ä¿è¯é«˜å¹¶å‘æ€§èƒ½

2. **crypto**: åŠ å¯†å·¥å…·
   - AESåŠ å¯†/è§£å¯†
   - æ”¯æŒå¤šç§åŠ å¯†æ¨¡å¼
   - çº¿ç¨‹å®‰å…¨çš„åŠ å¯†æ“ä½œ

3. **slice**: åˆ‡ç‰‡å·¥å…·
   - åˆ‡ç‰‡å·®é›†ã€äº¤é›†ã€å¹¶é›†æ“ä½œ
   - å…ƒç´ æŸ¥æ‰¾å’Œå»é‡
   - åˆ‡ç‰‡åˆ†é¡µå·¥å…·

4. **url**: URLå·¥å…·
   - URLè§£æå’Œæ„å»º
   - æŸ¥è¯¢å‚æ•°å¤„ç†
   - URLæ ‡å‡†åŒ–

5. **useragent**: ç”¨æˆ·ä»£ç†è§£æ
   - æµè§ˆå™¨ä¿¡æ¯æå–
   - æ“ä½œç³»ç»Ÿè¯†åˆ«
   - è®¾å¤‡ç±»å‹åˆ¤æ–­

6. **errors**: é€šç”¨é”™è¯¯å¤„ç†ç³»ç»Ÿ
   - çµæ´»çš„é”™è¯¯ç æ³¨å†Œç³»ç»Ÿ
   - æ”¯æŒåŠ¨æ€é”™è¯¯ç ç®¡ç†
   - é”™è¯¯åˆ†ç±»å’Œåˆ¤æ–­ï¼ˆç³»ç»Ÿã€å®¢æˆ·ç«¯ã€ä¸šåŠ¡ï¼‰
   - é”™è¯¯æ„å»ºå™¨æ¨¡å¼
   - é”™è¯¯æ ¼å¼åŒ–å™¨ï¼ˆé»˜è®¤ã€JSONï¼‰
   - é”™è¯¯å¤„ç†å™¨é“¾
   - é”™è¯¯èšåˆå™¨
   - å®Œæ•´çš„å †æ ˆè·Ÿè¸ªæ”¯æŒ

7. **captcha**: éªŒè¯ç ç”Ÿæˆå™¨ âœ¨ **æ–°å¢**
   - å¯†ç å­¦å®‰å…¨çš„éšæœºæ•°ç”Ÿæˆ(CSPRNG)
   - çº¯æ•°å­—å­—ç¬¦é›†ï¼Œé¿å…ç”¨æˆ·è¾“å…¥æ··æ·†
   - æ¨è6ä½é•¿åº¦ï¼Œå¹³è¡¡å®‰å…¨æ€§å’Œç”¨æˆ·ä½“éªŒ
   - æ”¯æŒ4-12ä½é•¿åº¦çš„çµæ´»é…ç½®
   - ç®€å•çš„éªŒè¯ç åŒ¹é…åŠŸèƒ½
   - æ ¼å¼éªŒè¯å’Œè‡ªå®šä¹‰å­—ç¬¦é›†æ”¯æŒ

## å®‰è£…

```bash
go get github.com/iwen-conf/utils-pkg
```

## éªŒè¯ç ç”Ÿæˆå™¨ä½¿ç”¨ç¤ºä¾‹

### åŸºç¡€ç”¨æ³•

```go
import "github.com/iwen-conf/utils-pkg/captcha"

// ç”Ÿæˆæ¨èçš„6ä½éªŒè¯ç 
code, err := captcha.Generate6()
if err != nil {
    panic(err)
}
fmt.Printf("éªŒè¯ç : %s\n", code)

// ç”Ÿæˆè‡ªå®šä¹‰é•¿åº¦çš„éªŒè¯ç 
code8, err := captcha.Generate(8)
if err != nil {
    panic(err)
}

// éªŒè¯éªŒè¯ç 
userInput := "123456"
if captcha.Validate(userInput, code) {
    fmt.Println("éªŒè¯ç æ­£ç¡®")
} else {
    fmt.Println("éªŒè¯ç é”™è¯¯")
}
```

### å®‰å…¨ç‰¹æ€§

```go
// ä½¿ç”¨å¯†ç å­¦å®‰å…¨çš„éšæœºæ•°ç”Ÿæˆå™¨
code, err := captcha.Generate6() // ä½¿ç”¨crypto/rand

// æ ¼å¼éªŒè¯
if captcha.IsValidFormat(userInput) {
    // éªŒè¯ç æ ¼å¼æ­£ç¡®
}

// ä¸åŒé•¿åº¦çš„éªŒè¯ç 
code4, _ := captcha.Generate4()  // 4ä½ï¼Œ1ä¸‡ç§ç»„åˆ
code6, _ := captcha.Generate6()  // 6ä½ï¼Œ100ä¸‡ç§ç»„åˆï¼ˆæ¨èï¼‰
code8, _ := captcha.Generate8()  // 8ä½ï¼Œ1äº¿ç§ç»„åˆ
```

## é”™è¯¯å¤„ç†æ¨¡å—ä½¿ç”¨ç¤ºä¾‹

### åŸºç¡€ç”¨æ³•

```go
import "github.com/iwen-conf/utils-pkg/errors"

// åˆ›å»ºç®€å•é”™è¯¯
err := errors.New("USER001", "ç”¨æˆ·ä¸å­˜åœ¨")

// åˆ›å»ºå¸¦è¯¦ç»†ä¿¡æ¯çš„é”™è¯¯
err = errors.NewWithDetails("DATA001", "æ•°æ®éªŒè¯å¤±è´¥", "è¾“å…¥å‚æ•°ä¸ç¬¦åˆè¦æ±‚")

// åŒ…è£…ç°æœ‰é”™è¯¯
dbErr := fmt.Errorf("æ•°æ®åº“è¿æ¥å¤±è´¥")
err = errors.Wrap(dbErr, "DB001", "æ•°æ®åº“æ“ä½œå¼‚å¸¸")
```

### é”™è¯¯ç æ³¨å†Œç³»ç»Ÿ

```go
// æ³¨å†Œè‡ªå®šä¹‰é”™è¯¯ç 
errors.RegisterErrorCode("CUSTOM001", "è‡ªå®šä¹‰ä¸šåŠ¡é”™è¯¯")

// æ‰¹é‡æ³¨å†Œé”™è¯¯ç 
errors.RegisterErrorCodes(map[string]string{
    "AUTH001": "è®¤è¯å¤±è´¥",
    "AUTH002": "æƒé™ä¸è¶³",
    "AUTH003": "ä»¤ç‰Œè¿‡æœŸ",
})

// æ³¨å†Œé”™è¯¯ç å‰ç¼€åˆ†ç±»
errors.RegisterErrorPrefix("AUTH", "authentication")
```

### é”™è¯¯æ„å»ºå™¨

```go
err := errors.NewBuilder().
    Code("USER001").
    Message("ç”¨æˆ·ä¸å­˜åœ¨").
    Details("ç”¨æˆ·IDæ— æ•ˆ").
    Context("user_id", "user123").
    Context("request_id", "req_456").
    Build()
```

### é”™è¯¯åˆ†ç±»å’Œåˆ¤æ–­

```go
// æ ¹æ®é”™è¯¯ç åˆ¤æ–­ç±»å‹
if errors.IsSystemError("5000") {
    // ç³»ç»Ÿçº§é”™è¯¯
}

if errors.IsClientError("4001") {
    // å®¢æˆ·ç«¯é”™è¯¯
}

if errors.IsBusinessErrorCode("6001") {
    // ä¸šåŠ¡é”™è¯¯
}

// è·å–é”™è¯¯åˆ†ç±»
category := errors.GetCategoryByCode("5000") // è¿”å› "server"
```

### é”™è¯¯æ ¼å¼åŒ–

```go
// ä½¿ç”¨é»˜è®¤æ ¼å¼åŒ–å™¨
formatted := errors.FormatError(err)

// è®¾ç½®è‡ªå®šä¹‰æ ¼å¼åŒ–å™¨
errors.SetDefaultFormatter(&errors.JSONFormatter{})

// ä½¿ç”¨é”™è¯¯å¤„ç†å™¨é“¾
handlerChain := errors.NewHandlerChain().
    Add(func(err *errors.Error) error {
        // è®°å½•é”™è¯¯æ—¥å¿—
        log.Printf("Error: %s", err.Error())
        return nil
    }).
    Add(func(err *errors.Error) error {
        // å‘é€é”™è¯¯é€šçŸ¥
        return nil
    })

handlerChain.Handle(err)
```

### é”™è¯¯èšåˆ

```go
aggregator := errors.NewAggregator()

// æ”¶é›†å¤šä¸ªé”™è¯¯
aggregator.Add(err1)
aggregator.Add(err2)
aggregator.Add(err3)

if aggregator.HasErrors() {
    // å¤„ç†èšåˆçš„é”™è¯¯
    for _, err := range aggregator.Errors() {
        fmt.Printf("Error: %s\n", err.Error())
    }
}
```

## é¢„å®šä¹‰é”™è¯¯ç 

ç³»ç»Ÿæä¾›äº†ä¸€å¥—é€šç”¨çš„é”™è¯¯ç ä½“ç³»ï¼š

- **å®¢æˆ·ç«¯é”™è¯¯ (4xxx)**: è¯·æ±‚é”™è¯¯ã€æœªæˆæƒã€ç¦æ­¢è®¿é—®ç­‰
- **æœåŠ¡ç«¯é”™è¯¯ (5xxx)**: å†…éƒ¨é”™è¯¯ã€æœåŠ¡ä¸å¯ç”¨ã€ç½‘å…³é”™è¯¯ç­‰  
- **ä¸šåŠ¡é”™è¯¯ (6xxx)**: ä¸šåŠ¡é€»è¾‘é”™è¯¯ã€æ•°æ®éªŒè¯å¤±è´¥ç­‰

æ‰€æœ‰é”™è¯¯ç éƒ½æ”¯æŒåŠ¨æ€æ³¨å†Œå’Œè‡ªå®šä¹‰æ‰©å±•ã€‚

## è¯¦ç»†æ–‡æ¡£

å„æ¨¡å—ä½¿ç”¨æ–¹æ³•è¯¦è§å„è‡ªç›®å½•ä¸‹çš„æ–‡æ¡£ã€‚

- [JWTä»¤ç‰Œç®¡ç†å™¨ä½¿ç”¨è¯´æ˜](jwt/ä½¿ç”¨è¯´æ˜.md)
- [åŠ å¯†å·¥å…·ä½¿ç”¨è¯´æ˜](crypto/ä½¿ç”¨è¯´æ˜.md)
- [åˆ‡ç‰‡å·¥å…·ä½¿ç”¨è¯´æ˜](slice/ä½¿ç”¨è¯´æ˜.md)
- [URLå·¥å…·ä½¿ç”¨è¯´æ˜](url/ä½¿ç”¨è¯´æ˜.md)
- [ç”¨æˆ·ä»£ç†è§£æå·¥å…·ä½¿ç”¨è¯´æ˜](useragent/ä½¿ç”¨è¯´æ˜.md)
- [é”™è¯¯å¤„ç†ç³»ç»Ÿä½¿ç”¨è¯´æ˜](errors/ä½¿ç”¨è¯´æ˜.md)
- [éªŒè¯ç ç”Ÿæˆå™¨ä½¿ç”¨è¯´æ˜](captcha/ä½¿ç”¨è¯´æ˜.md) âœ¨ **æ–°å¢**

## ç‰¹æ€§

- ğŸš€ **é«˜æ€§èƒ½**: ä½¿ç”¨å¯¹è±¡æ± ã€ç¼“å­˜ç­‰ä¼˜åŒ–æŠ€æœ¯
- ğŸ”’ **çº¿ç¨‹å®‰å…¨**: æ‰€æœ‰æ¨¡å—éƒ½ç»è¿‡å¹¶å‘å®‰å…¨è®¾è®¡
- ğŸ¯ **é€šç”¨æ€§**: ä¸å†å±€é™äºç‰¹å®šä¸šåŠ¡åœºæ™¯ï¼Œé€‚ç”¨äºå„ç§é¡¹ç›®
- ğŸ”§ **å¯æ‰©å±•**: æ”¯æŒè‡ªå®šä¹‰é”™è¯¯ç ã€æ ¼å¼åŒ–å™¨ã€å¤„ç†å™¨ç­‰
- ğŸ“š **å®Œæ•´æ–‡æ¡£**: æä¾›è¯¦ç»†çš„ä½¿ç”¨è¯´æ˜å’Œç¤ºä¾‹ä»£ç 
- âœ… **æµ‹è¯•è¦†ç›–**: æ‰€æœ‰æ¨¡å—éƒ½æœ‰å®Œæ•´çš„æµ‹è¯•è¦†ç›–
